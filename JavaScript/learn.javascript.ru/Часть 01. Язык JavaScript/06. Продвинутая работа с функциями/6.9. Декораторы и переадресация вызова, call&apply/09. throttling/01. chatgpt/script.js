/*2025.05.19 18:43 IMM*/

/*
ðŸ”§ Ð¦ÐµÐ»ÑŒ:
Ð¡Ð´ÐµÐ»Ð°Ñ‚ÑŒ Ð´ÐµÐºÐ¾Ñ€Ð°Ñ‚Ð¾Ñ€ throttle(f, ms), ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹:
Ð¡Ñ€Ð°Ð·Ñƒ Ð²Ñ‹Ð·Ñ‹Ð²Ð°ÐµÑ‚ f Ð¿Ñ€Ð¸ Ð¿ÐµÑ€Ð²Ð¾Ð¼ Ð²Ñ‹Ð·Ð¾Ð²Ðµ.
Ð‘Ð»Ð¾ÐºÐ¸Ñ€ÑƒÐµÑ‚ Ð¿Ð¾Ð²Ñ‚Ð¾Ñ€Ð½Ñ‹Ðµ Ð²Ñ‹Ð·Ð¾Ð²Ñ‹ Ð² Ñ‚ÐµÑ‡ÐµÐ½Ð¸Ðµ ms Ð¼Ð¸Ð»Ð»Ð¸ÑÐµÐºÑƒÐ½Ð´.
ÐŸÐ¾ÑÐ»Ðµ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ñ Ð¿Ð°ÑƒÐ·Ñ‹ Ð²Ñ‹Ð·Ñ‹Ð²Ð°ÐµÑ‚ f ÐµÑ‰Ñ‘ Ñ€Ð°Ð·, ÐµÑÐ»Ð¸ Ð±Ñ‹Ð»Ð¸ Ð¿Ð¾Ð¿Ñ‹Ñ‚ÐºÐ¸ Ð²Ñ‹Ð·Ð¾Ð²Ð°.
*/

function throttle(func, ms) {
  let isThrottled = false; // ðŸ”’ Ñ„Ð»Ð°Ð³ â€” Ð¼Ð¾Ð¶Ð½Ð¾ Ð»Ð¸ Ð²Ñ‹Ð·Ñ‹Ð²Ð°Ñ‚ÑŒ func?
  let savedArgs;           // ðŸ“¦ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ð°Ñ Ð´Ð»Ñ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ Ð°Ñ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð²
  let savedThis;           // ðŸ“¦ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ð°Ñ Ð´Ð»Ñ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ð°

  return function(...args) {
    if (isThrottled) {  
      savedArgs = args;    // Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð°Ñ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ñ‹
      savedThis = this;    // Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚
      return;              // ÐŸÑ€Ð¾Ð¿ÑƒÑÐºÐ°ÐµÐ¼ Ð²Ñ‹Ð·Ð¾Ð²
    }

    func.apply(this, args);   // Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÐ¼ Ñ„ÑƒÐ½ÐºÑ†Ð¸ÑŽ ÑÑ€Ð°Ð·Ñƒ
    isThrottled = true;       // Ð’ÐºÐ»ÑŽÑ‡Ð°ÐµÐ¼ Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²ÐºÑƒ

    setTimeout(() => {
      isThrottled = false;    // Ð¡Ð±Ñ€Ð°ÑÑ‹Ð²Ð°ÐµÐ¼ Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²ÐºÑƒ Ñ‡ÐµÑ€ÐµÐ· ms

      if (savedArgs) {        // Ð•ÑÐ»Ð¸ Ð±Ñ‹Ð»Ð¸ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ñ‹ Ð°Ñ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ñ‹
        func.apply(savedThis, savedArgs);  // Ð’Ñ‹Ð·Ð¾Ð²ÐµÐ¼ Ñ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ð¼Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ð¼Ð¸
        savedArgs = savedThis = null; // Ð¡Ð±Ñ€Ð¾ÑÐ¸Ð¼ ÑÐ¾Ñ…Ñ€Ð°Ð½Ñ‘Ð½Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ
      }
    }, ms);
  };
}

function log(a) {
  console.log(a);
}

let f = throttle(console.log, 1000);

f(1); // âœ… Ð²Ñ‹Ð²ÐµÐ´ÐµÑ‚ 1
f(2); // âŒ ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÐµÑ‚ 2
f(3); // âŒ ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÐµÑ‚ 3

// Ñ‡ÐµÑ€ÐµÐ· 1000 Ð¼Ñ ÑÐ½Ð¾Ð²Ð° Ð²Ñ‹Ð·Ñ‹Ð²Ð°ÐµÐ¼, Ð¸ Ð²Ñ‹Ð²Ð¾Ð´Ð¸Ð¼ 3
setTimeout(() => f(4), 1100); // âœ… Ð²Ñ‹Ð²ÐµÐ´ÐµÑ‚ 4
