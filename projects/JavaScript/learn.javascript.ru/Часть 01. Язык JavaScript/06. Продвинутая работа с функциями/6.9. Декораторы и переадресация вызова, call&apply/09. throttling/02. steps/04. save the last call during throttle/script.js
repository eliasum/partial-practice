/*2025.05.20 18:48 IMM*/

// ‚úÖ –®–ê–ì 4: —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π –≤—ã–∑–æ–≤ –≤–æ –≤—Ä–µ–º—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
// –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–∑—ã–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é –≤–æ –≤—Ä–µ–º—è "—Ç–æ—Ä–º–æ–∑–∞", –º—ã:
// ‚ùå –Ω–µ –≤—ã–∑—ã–≤–∞–µ–º func —Å—Ä–∞–∑—É;
// ‚úÖ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∏ this;
// ‚úÖ –ø–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è —Ç–æ—Ä–º–æ–∑–∞ ‚Äî –≤—ã–∑—ã–≤–∞–µ–º func —Å —ç—Ç–∏–º–∏ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏.

// "—Ç–æ—Ä–º–æ–∑—è—â–∞—è" —Ñ—É–Ω–∫—Ü–∏—è-–¥–µ–∫–æ—Ä–∞—Ç–æ—Ä
function throttle(func, ms) {
  // üîí –§–ª–∞–≥, –≤–∫–ª—é—á–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –≤—ã–∑–æ–≤–∞ –¥–µ–∫–æ—Ä–∏—Ä—É–µ–º–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –≤—ã–∫–ª—é—á–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ ms –º—Å
  let isThrottled = false;
  // –®–∞–≥ 4.1: –¥–æ–±–∞–≤–∏–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è
  let savedArgs;  // –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã
  let savedThis;  // –ø–æ—Å–ª–µ–¥–Ω–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç (this)

  // –æ–±—ë—Ä–Ω—É—Ç–∞—è —Ñ—É–Ω–∫—Ü–∏—è
  return function (...args) {
    // –®–∞–≥ 4.2: —Å–æ—Ö—Ä–∞–Ω—è–µ–º, –µ—Å–ª–∏ –≤—ã–∑–æ–≤ –±—ã–ª –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω
    if (isThrottled) {
      savedArgs = args;
      savedThis = this;
      return;
    }
    // –¢–µ–ø–µ—Ä—å, –µ—Å–ª–∏ –≤—ã–∑–æ–≤ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω ‚Äî –º—ã –µ–≥–æ –Ω–µ —Ç–µ—Ä—è–µ–º, –∞ –∑–∞–ø–æ–º–∏–Ω–∞–µ–º.

    // ‚úÖ –ü–µ—Ä–≤—ã–π –≤—ã–∑–æ–≤ –∏–ª–∏ –ø–æ—Å–ª–µ –ø–∞—É–∑—ã ‚Äî –∑–∞–ø—É—Å–∫–∞–µ–º –¥–µ–∫–æ—Ä–∏—Ä—É–µ–º—É—é —Ñ—É–Ω–∫—Ü–∏—é
    func.apply(this, args);

    // ‚õî –°—Ç–∞–≤–∏–º "—Ç–æ—Ä–º–æ–∑" ‚Äî –±–ª–æ–∫–∏—Ä—É–µ–º –¥–∞–ª—å–Ω–µ–π—à–∏–µ –≤—ã–∑–æ–≤—ã
    isThrottled = true;

    // ‚è≥ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä: —á–µ—Ä–µ–∑ ms –º—Å —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å
    setTimeout(() => {
      isThrottled = false; // üîì –¢–µ–ø–µ—Ä—å —Å–Ω–æ–≤–∞ –º–æ–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å

      if (savedArgs) {
        func.apply(savedThis, savedArgs); // –≤—ã–∑—ã–≤–∞–µ–º —Å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–º–∏
        savedArgs = savedThis = null;     // –æ—á–∏—â–∞–µ–º
      } 
    }, ms);
  };
}

function log(a) {
  console.log(a);
}

let throttledLog = throttle(log, 1000);

throttledLog(1); // ‚úÖ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç ‚Äî –≤—ã–≤–µ–¥–µ—Ç 1
throttledLog(2); // ‚ùå –∑–∞–ø–æ–º–Ω–∏—Ç—Å—è
throttledLog(3); // ‚ùå –ø–µ—Ä–µ–∑–∞–ø–∏—à–µ—Ç 2 ‚Üí –∑–∞–ø–æ–º–Ω–∏—Ç—Å—è 3

// –ß–µ—Ä–µ–∑ 1000 –º—Å –≤—ã–≤–µ–¥–µ—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–π ‚Üí 3